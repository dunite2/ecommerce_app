<div class="products-page">
  <div class="container mt-4">
        <div class="row mb-4">
      <div class="col-12">
        <h1 class="page-title">Currently Available</h1>
        <p class="page-subtitle">Check out our available products</p>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-4">
        <%= form_with url: products_path, method: :get, class: "d-flex" do |form| %>
          <%= form.text_field :q, placeholder: "Search products...", class: "form-control me-2", value: params[:q] %>
          <%= form.submit "Search", class: "btn btn-success" %>
        <% end %>
      </div>
      <div class="col-md-8">
        <div class="row">
          <!-- Filter Button -->
          <div class="col-md-5">
            <div class="d-flex gap-2">
              <%= link_to products_path(params.permit(:q, :sort).merge(recently_updated: params[:recently_updated] == 'true' ? nil : 'true')), 
                    class: "btn #{'btn-success' if params[:recently_updated] == 'true'} #{'btn-outline-success' if params[:recently_updated] != 'true'} btn-sm" do %>
                <i class="fas fa-clock me-1"></i>Recently Updated
              <% end %>
              
              <% if params[:q].present? || params[:recently_updated].present? %>
                <%= link_to products_path, class: "btn btn-outline-secondary btn-sm" do %>
                  <i class="fas fa-times me-1"></i>Clear Filters
                <% end %>
              <% end %>
            </div>
          </div>
          
          <!-- Sort Dropdown -->
          <div class="col-md-7 text-end">
            <%= form_with url: products_path, method: :get, local: true, class: "d-inline" do |form| %>
              <%= form.hidden_field :q, value: params[:q] %>
              <%= form.hidden_field :recently_updated, value: params[:recently_updated] %>
              <%= form.select :sort, 
                    options_for_select([
                      ['Newest First', 'newest'],
                      ['Price: Low to High', 'price_asc'],
                      ['Price: High to Low', 'price_desc'],
                      ['Name A-Z', 'name_asc']
                    ], params[:sort]),
                    { prompt: "Sort by" },
                    { class: "form-select", onchange: "this.form.submit();" } %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    
    <div class="row">
      <% if @products && @products.any? %>
        <% @products.each do |product| %>
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="product-card">
              <div class="product-image">
                <%= image_tag product.image.present? ? product.image : "isuzu.jpg", alt: product.name, class: "img-fluid" %>
              </div>
              <div class="product-info p-3">
                <h5 class="product-name"><%= product.name %></h5>
                <p class="product-description"><%= truncate(product.descrption, length: 100) %></p>
                <div class="product-price">
                  <span class="price">$<%= product.price %></span>
                </div>
                <div class="product-actions mt-3">
                  <%= link_to "View Details", product_path(product), class: "btn btn-outline-success me-2" %>
                  <%= button_to "Add to Cart", add_item_cart_path, 
                        params: { product_id: product.id, quantity: 1 }, 
                        method: :post, class: "btn btn-success" %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="product-card">
            <div class="product-image">
              <div class="placeholder-image">üìø</div>
            </div>
            <div class="product-info p-3">
              <h5 class="product-name">Ceremonial Grade Matcha</h5>
              <p class="product-description">Premium ceremonial grade matcha powder perfect for traditional tea ceremonies.</p>
              <div class="product-price">
                <span class="price">$45.00</span>
              </div>
              <div class="product-actions mt-3">
                <button class="btn btn-outline-success me-2">View Details</button>
                <button class="btn btn-success">Add to Cart</button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-6 mb-4">
          <div class="product-card">
            <div class="product-image">
              <div class="placeholder-image">ü•Ñ</div>
            </div>
            <div class="product-info p-3">
              <h5 class="product-name">Marukyu Koyamaen Isuzu</h5>
              <p class="product-description">Isuzu matcha has a refreshing aroma, astringent, mellow umami and slightly bitter flavor.</p>
              <div class="product-price">
                <span class="price">$25.00</span>
              </div>
              <div class="product-actions mt-3">
                <button class="btn btn-outline-success me-2">View Details</button>
                <button class="btn btn-success">Add to Cart</button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-6 mb-4">
          <div class="product-card">
            <div class="product-image">
              <div class="placeholder-image">üçµ</div>
            </div>
            <div class="product-info p-3">
              <h5 class="product-name">Matcha Bowl Set</h5>
              <p class="product-description">Authentic ceramic matcha bowl (chawan) for the complete matcha experience.</p>
              <div class="product-price">
                <span class="price">$35.00</span>
              </div>
              <div class="product-actions mt-3">
                <button class="btn btn-outline-success me-2">View Details</button>
                <button class="btn btn-success">Add to Cart</button>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Back to Home -->
    <div class="row mt-4">
      <div class="col-12 text-center">
        <%= link_to "‚Üê Back to Home", root_path, class: "btn btn-outline-success" %>
      </div>
    </div>
  </div>
</div>
