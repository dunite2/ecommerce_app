<div class="products-page">
  <div class="container mt-4">
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="page-title">Currently Available</h1>
        <p class="page-subtitle">Check out our available products</p>
      </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="row mb-4">
      <div class="col-md-4">
        <%= form_with url: products_path, method: :get, class: "d-flex" do |form| %>
          <%= form.text_field :q, placeholder: "Search products...", class: "form-control me-2", value: params[:q] %>
          <%= form.submit "Search", class: "btn btn-success" %>
        <% end %>
      </div>
      <div class="col-md-8">
        <div class="row">
          <!-- Filter Button -->
          <div class="col-md-5">
            <div class="d-flex gap-2">
              <%= link_to products_path(params.permit(:q, :sort).merge(recently_updated: params[:recently_updated] == 'true' ? nil : 'true')), 
                    class: "btn #{'btn-success' if params[:recently_updated] == 'true'} #{'btn-outline-success' if params[:recently_updated] != 'true'} btn-sm" do %>
                <i class="fas fa-clock me-1"></i>Recently Updated
              <% end %>
              
              <% if params[:q].present? || params[:recently_updated].present? %>
                <%= link_to products_path, class: "btn btn-outline-secondary btn-sm" do %>
                  <i class="fas fa-times me-1"></i>Clear Filters
                <% end %>
              <% end %>
            </div>
          </div>
          
          <!-- Sort Dropdown -->
          <div class="col-md-7 text-end">
            <%= form_with url: products_path, method: :get, local: true, class: "d-inline" do |form| %>
              <%= form.hidden_field :q, value: params[:q] %>
              <%= form.hidden_field :recently_updated, value: params[:recently_updated] %>
              <%= form.select :sort, 
                    options_for_select([
                      ['Newest First', 'newest'],
                      ['Price: Low to High', 'price_asc'],
                      ['Price: High to Low', 'price_desc'],
                      ['Name A-Z', 'name_asc']
                    ], params[:sort]),
                    { prompt: "Sort by" },
                    { class: "form-select", onchange: "this.form.submit();" } %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    
    <div class="row">
      <% if @products && @products.any? %>
        <% @products.each do |product| %>
          <%= render 'shared/product_card', product: product %>
        <% end %>
      <% else %>
        <%= render 'shared/sample_products' %>
      <% end %>
    </div>

    <!-- Back to Home -->
    <div class="row mt-4">
      <div class="col-12 text-center">
        <%= link_to "← Back to Home", root_path, class: "btn btn-outline-success" %>
      </div>
    </div>
  </div>
</div>
